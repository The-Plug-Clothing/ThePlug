<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>The Plug - Cart</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
<style>
  body { font-family:'Poppins',sans-serif; margin:0; background:white; color:#222; }
  header { display:flex; justify-content:space-between; align-items:center; padding:20px 40px; border-bottom:1px solid #ddd; }
  .logo { font-weight:700; font-size:1.8em; text-decoration:none; color:black; }
  nav ul { list-style:none; display:flex; gap:30px; margin:0; padding:0; }
  nav ul li a { text-decoration:none; color:black; font-weight:600; font-size:1.1em; padding:6px 0; border-bottom:2px solid transparent; transition:0.3s; }
  nav ul li a:hover, nav ul li a.active { border-bottom:2px solid black; }
  main { max-width:900px; margin:40px auto; padding:0 20px; }
  h1 { font-weight:700; font-size:2.5rem; margin-bottom:30px; }
  table { width:100%; border-collapse:collapse; margin-bottom:30px; }
  th, td { border:1px solid #ddd; padding:12px; text-align:left; }
  th { background:#f9f9f9; }
  .total-row td { font-weight:700; font-size:1.2em; }
  #paypal-button-container { margin-top:20px; }
  button.remove-btn { padding:5px 10px; background:#e74c3c; color:#fff; border:none; border-radius:5px; cursor:pointer; }
  button.remove-btn:hover { background:#c0392b; }
  td.qty input { width:50px; text-align:center; }
</style>
<script src="https://www.paypal.com/sdk/js?client-id=AagqT4KKVvZtA4lWgnjLY2U8ZnJ4T0RscbbrD8nxaGOJ1oVhrTYTp1uZ926rIXcVm3Duke7DUdPcblZs&currency=USD"></script>
</head>
<body>

<header>
  <a href="index.html" class="logo">The Plug</a>
  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="catalog.html">Catalog</a></li>
      <li><a href="about.html">About</a></li>
      <li><a href="contact.html">Contact</a></li>
      <li><a href="cart.html" class="active">Cart üõí <span id="cart-count">0</span></a></li>
    </ul>
  </nav>
</header>

<main>
  <h1>Your Shopping Cart</h1>
  <table>
    <thead>
      <tr>
        <th>Product</th>
        <th>Qty</th>
        <th>Price</th>
        <th>Subtotal</th>
        <th>Remove</th>
      </tr>
    </thead>
    <tbody id="cart-items">
      <tr><td colspan="5" style="text-align:center;">Your cart is empty.</td></tr>
    </tbody>
    <tfoot>
      <tr class="total-row">
        <td colspan="3" style="text-align:right;">Total:</td>
        <td id="cart-total">$0.00</td>
        <td></td>
      </tr>
    </tfoot>
  </table>
  <div id="paypal-button-container"></div>
</main>

<script>
// Load cart
let cart = JSON.parse(localStorage.getItem("cart")) || [];

// Update header count
function updateCartCount() {
  document.getElementById("cart-count").textContent = cart.reduce((s,i)=>s+i.qty,0);
}

// Render cart table
function renderCart() {
  const container = document.getElementById("cart-items");
  container.innerHTML = "";
  if(cart.length === 0){
    container.innerHTML = `<tr><td colspan="5" style="text-align:center;">Your cart is empty.</td></tr>`;
    document.getElementById("cart-total").textContent = "$0.00";
    return;
  }

  let total = 0;
  cart.forEach((item,index)=>{
    const subtotal = item.price * item.qty;
    total += subtotal;
    container.innerHTML += `
      <tr>
        <td>${item.product}</td>
        <td class="qty"><input type="number" min="1" value="${item.qty}" data-index="${index}"></td>
        <td>$${item.price.toFixed(2)}</td>
        <td>$${subtotal.toFixed(2)}</td>
        <td><button class="remove-btn" data-index="${index}">‚ùå Remove</button></td>
      </tr>
    `;
  });

  document.getElementById("cart-total").textContent = `$${total.toFixed(2)}`;

  // Remove buttons
  document.querySelectorAll(".remove-btn").forEach(btn=>{
    btn.addEventListener("click",()=>{
      cart.splice(btn.dataset.index,1);
      localStorage.setItem("cart",JSON.stringify(cart));
      renderCart();
      updateCartCount();
    });
  });

  // Quantity change
  document.querySelectorAll("td.qty input").forEach(input=>{
    input.addEventListener("change",()=>{
      let idx = input.dataset.index;
      let val = parseInt(input.value);
      if(val<1) val = 1;
      cart[idx].qty = val;
      localStorage.setItem("cart",JSON.stringify(cart));
      renderCart();
      updateCartCount();
    });
  });
}

// Initialize PayPal
function initPayPal() {
  paypal.Buttons({
    createOrder: (data, actions) => {
      let total = cart.reduce((sum,item)=>sum+item.price*item.qty,0);
      return actions.order.create({
        purchase_units: [{ amount: { value: total.toFixed(2) } }]
      });
    },
    onApprove: (data, actions) => {
      return actions.order.capture().then(details => {
        alert("Thanks " + details.payer.name.given_name + "! Your payment was successful.");
        cart = [];
        localStorage.setItem("cart",JSON.stringify(cart));
        renderCart();
        updateCartCount();
        window.location.href = "thankyou.html";
      });
    }
  }).render('#paypal-button-container');
}

// Init
updateCartCount();
renderCart();
initPayPal();
</script>

</body>
</html>
